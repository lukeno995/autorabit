<apex:page showHeader="true" sidebar="true" standardController="Case" extensions="OF_TT_PhaseTransictions_Controller">
	<apex:includeScript value="/support/console/36.0/integration.js"/>
	<apex:includeScript value="/soap/ajax/20.0/connection.js"/>
	<apex:stylesheet value="{!URLFOR($Resource.LDS, 'assets/styles/salesforce-lightning-design-system.min.css')}"/>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>    
	    
	<script type="text/javascript">
	function returnToCase(operatore){
		
		if('{!Case.EOF_Fase__c}'=='On Field'){
			if (document.getElementById("{!$Component.theForm.thePageBlock.checkOper}").value=='') {
				alert('Compilare il campo Note Operatore on Field');
			}
			else if( document.getElementById("{!$Component.theForm.thePageBlock2.checkOnFieldInterv}").value=='') {
				alert('Compilare il campo Descrizione Intervento Risoluzione');
			}
			else{ 
		        if(sforce.console.isInConsole()){       
		          alert('Ticket correttamente inviato all\''+operatore);
		          testCloseTab(); 
		        }
		        else{
		          alert('Ticket correttamente inviato all\''+operatore);
		          	window.top.location.href ='{!urlRedir}';
		        }
		    }
		}
		else{
			if (document.getElementById("{!$Component.theForm.thePageBlock.checkOper}").value=='') {
				alert('Compilare campo Note Operatore Collaudo');
			}
			else{
		        if(sforce.console.isInConsole()){       
		          alert('Ticket correttamente inviato all\''+operatore);
		          testCloseTab(); 
		        }
		        else{
		        	alert('Ticket correttamente inviato all\''+operatore);
		          	window.top.location.href ='{!urlRedir}';
		        }
		    }
		}
    }
    function testCloseTab(){
        //First find the ID of the current tab to close it
        sforce.console.getEnclosingTabId(closeSubtab);
    }
        
    var closeSubtab = function closeSubtab(result){
        //Now that we have the tab ID, we can close it
        var tabId = result.id;
        sforce.console.closeTab(tabId);
    };
       

    </script>
	<apex:sectionHeader title="Trouble Ticket" subtitle="Note operatore" />
	<apex:form id="theForm">
	<apex:pageBlock title="Considerazioni {!title}" id="thePageBlock">
	
	<apex:messages ></apex:messages>
		<apex:pageBlockButtons location="top">
			
				<apex:commandLink action="{!InviaOnField}" value="Invia on Field" reRender="buttonBlock"
                      styleClass="slds-button slds-button--brand" style="margin-right:5px;" rendered="{!IF((Case.status='In Lavorazione' && Case.EOF_Fase__c='In Analisi' && Case.recordType.name='Trouble Ticket' && Case.owner.name!='Trouble Ticket - Coda Analisi'&& Case.owner.name!='Trouble Ticket - Coda on Field' && Case.owner.name!='Trouble Ticket - Coda in Collaudo'&&oper='Field'),'true','false')}"
                      oncomplete="returnToCase('Operatore On Field')">
    			</apex:commandLink>
    			<apex:commandLink action="{!InviaInCollaudo}" value="Invia in Collaudo" reRender="buttonBlock"
                      styleClass="slds-button slds-button--brand" style="margin-right:5px;" rendered="{!IF(((Case.status='In Lavorazione' && Case.EOF_Fase__c='On Field' || Case.status='In Lavorazione' && Case.EOF_Fase__c='In Analisi') && Case.recordType.name='Trouble Ticket' && Case.owner.name!='Trouble Ticket - Coda Analisi' && Case.owner.name!='Trouble Ticket - Coda on Field' && Case.owner.name!='Trouble Ticket - Coda in Collaudo'&&oper='Collaudo'),'true','false')}"
                      oncomplete="returnToCase('Operatore Collaudo')">
    			</apex:commandLink>
    			<apex:commandLink action="{!InviaInAnalisi}" value="Invia in Analisi" reRender="buttonBlock"
                      styleClass="slds-button slds-button--brand" style="margin-right:5px;" rendered="{!IF((Case.status='In Lavorazione' && Case.EOF_Fase__c='In Collaudo' && Case.recordType.name='Trouble Ticket' && Case.owner.name!='Trouble Ticket - Coda Analisi' && Case.owner.name!='Trouble Ticket - Coda on Field' && Case.owner.name!='Trouble Ticket - Coda in Collaudo'&&oper='Analisi'),'true','false')}"
                      oncomplete="returnToCase('Operatore Analisi')">
    			</apex:commandLink>
    			<apex:commandLink action="{!Cancel}" value="Cancella" reRender="buttonBlock"
                      styleClass="slds-button slds-button--brand" style="margin-right:5px;">
    			</apex:commandLink>
			
		</apex:pageBlockButtons>
			
				<apex:inputField style="width: 500px; height: 100px" value="{!c.EOF_Note_Operatore__c}" id="checkOper" required="true" />
				
				
			
	</apex:pageBlock>
	<apex:pageBlock title="Descrizione Intervento Risoluzione" id="thePageBlock2" rendered="{!if(c.status='In Lavorazione' && c.EOF_Fase__c='On Field' && c.Owner.Name!='Trouble Ticket - Coda on FIeld',true,false)}">
		<apex:inputField style="width: 500px; height: 20px" value="{!c.EOF_Descrizione_Intervento_Risoluzione__c}" id="checkOnFieldInterv" required="true" />
	</apex:pageBlock>
	</apex:form>
</apex:page>