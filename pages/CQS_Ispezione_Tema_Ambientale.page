<apex:page standardController="OF_CQS_Ispezione__c" extensions="Cqs_Ispezione_CustomController">
 <Style>
        .red{color:red;}
    </Style>
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>            
    <link rel = "stylesheet"  type = "text/css"  href = "//code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
    <!---apex:include pageName="{!pageName}"/--->
    <apex:pageMessages id="pm"/>
    <apex:sectionHeader title="Ispezione" subtitle="Ispezione Tema Ambientale"/>
    <apex:form id="theForm">
        <script>
        function showRow(){             {
            document.getElement("{!isp.CQS_Isp_Nome_Cognome2__c}").style.dispaly = "none";
            return false;
        }
        </script> 
        <apex:pageBlock title="Ispezione Tema Ambientale" mode="edit">
               
         <apex:outputPanel id="ipsec">
                <apex:pageBlockSection title="Ispezione Tema Ambientale" columns="2">
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                <apex:outputField value="{!isp.OF_CQS_Committente_Opera__c}"/>
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
             <apex:actionRegion id="ipsec1" >
                    <apex:pageBlockSectionItem >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>Progetto </b>&nbsp;&nbsp;&nbsp;
                        <apex:selectList label="Progetto" value="{!projectName}" size="1"  >
                            <apex:selectOptions value="{!optNomeProgetto}"/>  
                            <apex:actionSupport event="onchange" action="{!defineLDO}"  reRender="ipsec" />
                        </apex:selectList>
                    </apex:pageBlockSectionItem>
                      </apex:actionRegion>
                   <apex:outputfield value="{!isp.CQS_ISP_LDO__c}" />
                      <br/>
                         <apex:pageBlockSectionItem />
                            <apex:outputField value="{!isp.OF_CQS_Impresa_Mandataria__c}" />
              </apex:pageBlockSection>
        </apex:outputPanel>   
            <apex:pageBlockSection columns="2" collapsible="true">   
                    <apex:inputField value="{!OF_CQS_Ispezione__c.OF_CQS_Impresa_Ispezionata__c}" required="true"/>
                    <apex:inputField value="{!isp.OF_CQS_ISP_Verbale_N__c}"/>
                    <apex:inputField value="{!OF_CQS_Ispezione__c.OF_CQS_Data_Ispezione__c}" required="true"/>
                    <apex:inputField value="{!OF_CQS_Ispezione__c.Ora_Inizio_Sopralluogo__c}"/>
                    <apex:inputField value="{!OF_CQS_Ispezione__c.CQS_ISP_ora_fine_sop__c}"/>
                    <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                
                <apex:outputField value="{!isp.CQS_ISP_Punteggio_Totale__c}"/>
                <apex:outputField value="{!isp.CQS_ISP_Perc_Tot_Punt__c}"/>
                <apex:outputField value="{!isp.CQS_Punteggio_Tot_Max_Isp__c}"/>
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                </apex:pageBlockSection>
                
                <apex:pageBlockSection title="Luogo Ispezione" columns="2" collapsible="true">
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                <apex:inputField value="{!isp.OF_CQS_ISP_VIA__c}" required="true"></apex:inputField>
                <apex:inputField value="{!isp.OF_CQS_ISP_Lotto__c}"/>
                <apex:inputField value="{!isp.OF_CQS_ISP_Numero_Civico__c}" required="true"/>
                <apex:inputField value="{!isp.OF_CQS_ISP_Area_Cavo__c}"/>
                <apex:inputField value="{!isp.OF_CQS_ISP_CAP__c}"/>
                <apex:pageBlockSectionItem />
                <!--<apex:inputField value="{!isp.OF_CQS_ISP_Comune__c}" required="true"/>-->
            <apex:actionRegion >                                                    
              <label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <b>Comune</b></label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <apex:inputText id="comuneId" value="{!searchTerm}" styleClass="form-control" />
                <apex:inputHidden id="searchcommuneId" value="{!selectedIdComune}" />
            </apex:actionRegion>
                <apex:pageBlockSectionItem />
               
                <apex:inputField value="{!isp.OF_CQS_ISP_Provincia__c}"/>                   
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
            </apex:pageBlockSection>
            
 <!-- EC 20190102 start commenti-->
            <apex:outputpanel id="sez6" rendered="{!ss6}">
                 <apex:pageBlockSection title="Gestione Rifiuti" collapsible="true">
                
                        <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                <apex:selectRadio value="{!isp.CQS_IspQ_Mat_trasp_discarica_autorizz__c}" required="true">
                 <span   class="helpButton"><img src="/s.gif" alt="" class="helpOrb"
          		 title="{!$ObjectType.OF_CQS_Ispezione__c.Fields.CQS_IspQ_Mat_trasp_discarica_autorizz__c.inlineHelpText}"/>
                 </span>
                    <apex:selectOption itemValue="Si" itemlabel="Sì"/>
                    <apex:selectOption itemValue="No" itemlabel="No"/>
                    <apex:selectOption itemValue="N/A" itemlabel="N/A"/>
                </apex:selectRadio>
                 <apex:outputField value="{!isp.CQS_IspQ_Tot_Gest_Rifiuti_lav_in_corso__c}"/>
             <apex:selectRadio value="{!isp.CQS_IspQ_gestione_compilazione_FIR_OK__c}">
                 <span   class="helpButton"><img src="/s.gif" alt="" class="helpOrb"
          		 title="{!$ObjectType.OF_CQS_Ispezione__c.Fields.CQS_IspQ_gestione_compilazione_FIR_OK__c.inlineHelpText}"/>
                 </span>
                    <apex:selectOption itemValue="Si" itemlabel="Sì"/>
                    <apex:selectOption itemValue="No" itemlabel="No"/>
                    <apex:selectOption itemValue="N/A" itemlabel="N/A"/>
                </apex:selectRadio>
              <apex:outputField value="{!isp.CQS_IspQ_Tot_Max_Gest_rif_LavInCorso__c}"/>
               <apex:selectRadio value="{!isp.CQS_Isp_Gest_comp_registro_car_scar_OK__c}" required="true">
                 <span   class="helpButton"><img src="/s.gif" alt="" class="helpOrb"
          		 title="{!$ObjectType.OF_CQS_Ispezione__c.Fields.CQS_Isp_Gest_comp_registro_car_scar_OK__c.inlineHelpText}"/>
                 </span>
                    <apex:selectOption itemValue="Si" itemlabel="Sì"/>
                    <apex:selectOption itemValue="No" itemlabel="No"/>
                    <apex:selectOption itemValue="N/A" itemlabel="N/A"/>
                </apex:selectRadio>
                 <apex:pageBlockSectionItem />
                 <apex:selectRadio value="{!isp.CQS_IspQ_Identif_tipi_rifiuti_presenti__c}" required="true">
                 <span   class="helpButton"><img src="/s.gif" alt="" class="helpOrb"
          		 title="{!$ObjectType.OF_CQS_Ispezione__c.Fields.CQS_IspQ_Identif_tipi_rifiuti_presenti__c.inlineHelpText}"/>
                 </span>
                    <apex:selectOption itemValue="Si" itemlabel="Sì"/>
                    <apex:selectOption itemValue="No" itemlabel="No"/>
                    <apex:selectOption itemValue="N/A" itemlabel="N/A"/>    
                </apex:selectRadio>
                <apex:pageBlockSectionItem />
                <apex:selectRadio value="{!isp.CQS_IspQ_Iscr_Albo_Gest_Ambientali_MUD__c}" required="true">
                 <span   class="helpButton"><img src="/s.gif" alt="" class="helpOrb"
          		 title="{!$ObjectType.OF_CQS_Ispezione__c.Fields.CQS_IspQ_Iscr_Albo_Gest_Ambientali_MUD__c.inlineHelpText}"/>
                 </span>
                    <apex:selectOption itemValue="Si" itemlabel="Sì"/>
                    <apex:selectOption itemValue="No" itemlabel="No"/>
                    <apex:selectOption itemValue="N/A" itemlabel="N/A"/>
                </apex:selectRadio>
              <apex:pageBlockSectionItem />
                 <apex:selectRadio value="{!isp.CQS_IspQ_Pres_lic_autotrasp_conto_3i__c}" required="true">
                 <span   class="helpButton"><img src="/s.gif" alt="" class="helpOrb"
          		 title="{!$ObjectType.OF_CQS_Ispezione__c.Fields.CQS_IspQ_Pres_lic_autotrasp_conto_3i__c.inlineHelpText}"/>
                 </span>
                    <apex:selectOption itemValue="Si" itemlabel="Sì"/>
                    <apex:selectOption itemValue="No" itemlabel="No"/>
                 <apex:selectOption itemValue="N/A" itemlabel="N/A"/>
                </apex:selectRadio>
                <apex:pageBlockSectionItem />
                    <apex:selectRadio value="{!isp.CQS_IspQ_Pulizia_ok_postLav_NT_Istr__c}" required="true">
                 <span   class="helpButton"><img src="/s.gif" alt="" class="helpOrb"
          		 title="{!$ObjectType.OF_CQS_Ispezione__c.Fields.CQS_IspQ_Pulizia_ok_postLav_NT_Istr__c.inlineHelpText}"/>
                 </span>
                      <apex:selectOption itemValue="Si" itemlabel="Sì"/>
                    <apex:selectOption itemValue="No" itemlabel="No"/>
                      <apex:selectOption itemValue="N/A" itemlabel="N/A"/>
                    </apex:selectRadio>
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />       
                 </apex:pageBlockSection>
            </apex:outputpanel><!-- EC commento perché la sezione ora sarà di un altro tipo di ispezione (Tema Ambientale)  -->
             
  <!-- EC 20190102 start commenti nuovo tipo ispezione Tema Ambientale   -->       
  <!--          <apex:outputpanel id="sez13" rendered="{!ss13}">
                 <apex:pageBlockSection title="Gestione Rifiuti a Lavorazioni Concluse" collapsible="true">
                    <apex:pageBlockSectionItem />
                     <apex:pageBlockSectionItem />
                     <apex:selectRadio value="{!isp.CQS_IspQ_Pulizia_post_lav_NT_Istr_OK_LT__c}" required="true">
                            <apex:selectOption itemValue="Si" itemlabel="Sì"/>
                            <apex:selectOption itemValue="No" itemlabel="No"/>
                            <apex:selectOption itemValue="N/A" itemlabel="N/A"/>
                        </apex:selectRadio>
                     <apex:outputField value="{!isp.CQS_IspQ_Tot_Gest_Rifiuti_lav_terminati__c}"/>
                      <apex:pageBlockSectionItem />
                      <apex:outputField value="{!isp.CQS_IspQ_Tot_Max_Gest_Rif_Lav_Terminate__c}"/>
                     <apex:pageBlockSectionItem />
                     <apex:pageBlockSectionItem />
                 </apex:pageBlockSection>
            </apex:outputpanel> --><!--EC 20190102 end commenti nuovo tipo ispezione Tema Ambientale -->
            
              <apex:pageBlockSection title="Relazione Tecnica" collapsible="true">
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                <apex:inputField value="{!isp.CQS_RELAZIONE_TECNICA_DEL_COORDINATORE__c}"/>
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />             
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Responsabile Redazione Ispezione di Sicurezza" collapsible="true" columns="2">
                <apex:pageBlockSectionItem />
                <apex:outputField label="Responsabile Redazione" value="{!isp.Owner.Name}"/>
                <apex:pageBlockSectionItem />
                <p style="margin-left:30px;">            {!$User.FirstName}  {!$User.LastName}</p>
            </apex:pageBlockSection>
            <apex:pageBlockButtons > 
                <apex:commandButton value="Salva ispezione" action="{!salvaIspezione}"  rerender="ipsec,pb,pm" />
                <!--  <apex:commandButton value="Cancel" action="{!cancel}"/> -->
            </apex:pageBlockButtons>            
        </apex:pageBlock> 
    
            <html lang="en">
            <head>
                <script type="text/javascript">
                var PLACEHOLDER = 'Digita almeno 2 caratteri'; 
                var AccountObjects;
                var queryTerm;                
                $(document).ready(function() {
                    $('[id$=comuneId]').autocomplete({minLength: 2,
                                                      source: function(request, response) {                            
                                                          queryTerm = request.term;
                                                          Cqs_Ispezione_CustomController.searchComune(request.term, function(result, event){
                                                              if(event.type == 'exception') {
                                                                  alert(event.message);
                                                              } else {
                                                                  AccountObjects = result;                            
                                                                  console.log('==>'+AccountObjects);
                                                                  response(AccountObjects);
                                                              }
                                                          });
                                                      },
                                                      focus: function( event, ui ) {
                                                          //  $('[id$=comuneId]').val( ui.item.Name);
                                                          return false;
                                                      },
                                                      select: function( event, ui ) {
                                                          $('[id$=comuneId]').val( ui.item.OF_Comune__c  );
                                                          $('[id$=searchcommuneId]').val( ui.item.Id);
                                                          return false;
                                                      },
                                                     })
                    .data( "ui-autocomplete" )._renderItem = function( ul, item ) {
                        var entry = "<a>" + item.OF_Comune__c;
                        
                        entry = entry + "</a>";
                        entry = entry.replace(queryTerm, "<b>" + queryTerm + "</b>");
                        return $( "<li></li>" )
                        .data( "ui-autocomplete-item", item )
                        .append( entry )
                        .appendTo( ul );
                    };
                    
                    // Add or remove placeholder values
                    $('[id$=comuneId]').val(PLACEHOLDER);
                    $('[id$=comuneId]').on("focus",  function(event){
                        $tgt = $(event.target);
                        if($tgt.val() === PLACEHOLDER ){
                            $tgt.val('');
                            $tgt.removeClass('placeHolder');
                        }
                    });
                    $('[id$=comuneId]').on( "blur",  function(event){
                        $tgt = $(event.target);
                        if($tgt.val() === '' ){
                            $tgt.val(PLACEHOLDER);
                            $tgt.addClass('placeHolder');
                        }
                    });
                    
                });
                </script>
            </head>            
        </html>
                  
        </apex:form>
    
</apex:page>