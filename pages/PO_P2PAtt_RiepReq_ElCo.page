<apex:page controller="PO_P2PAtt_RiepReq_ElCoCntrl" docType="html-5.0" applyhtmltag="false" showheader="false" sidebar="false" standardstylesheets="false" action="{!deleteVoidKitLog}">
    <html lang="en">
        <head> 
            <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>        
            <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
            <meta name="viewport" content="width=device-width, initial-scale=1"/>
            <title>Open Fiber</title>  
            <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" /> 
            <!-- Bootstrap Core CSS -->
            <apex:stylesheet value="{!URLFOR($Resource.ENELfiles, 'ENELfiles/EnelStylesheets/files/vendor/bootstrap/css/bootstrap.min.css')}"/>
            
            <!-- MetisMenu CSS -->
            <apex:stylesheet value="{!URLFOR($Resource.ENELfiles, 'ENELfiles/EnelStylesheets/files/vendor/metisMenu/metisMenu.min.css')}"/>
            
            <!-- Custom CSS -->
            <apex:stylesheet value="{!URLFOR($Resource.ENELfiles, 'ENELfiles/EnelStylesheets/files/dist/css/sbadmin2.css')}"/>
            
            <!-- Morris Charts CSS -->
            <apex:stylesheet value="{!URLFOR($Resource.ENELfiles, 'ENELfiles/EnelStylesheets/files/vendor/morrisjs/morris.css')}"/>
            
            <!-- Custom Fonts -->
            <apex:stylesheet value="{!URLFOR($Resource.ENELfiles, 'ENELfiles/EnelStylesheets/files/vendor/fontawesome/css/fontawesome.min.css')}"/>
            
            <style>
                .navbar {
                min-height: 105px;
                }
                .navbar-header {
                float: none;
                }
                .navbar-default {
                background-color: #ffffff;
                }
                .panel-default>.panel-heading {
                color: #ffffff;
                background-color: #337ab7;
                }
                span.dateFormat{
                
                display:none;
                
                } 
                .red{color:red;}
                .form-check-input{ 
                margin-left: 45px !important;
                margin-top: 10px;
                }
                
            </style>
        </head>
        <body> 
            <div id="wrapper">
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
                    <c:PO_SideBarComponent Rec="{!recordOfferta}" />
                    <div class="navbar-default sidebar" role="navigation">
                        <div class="sidebar-nav navbar-collapse">
                            <ul class="nav" id="side-menu">
                            </ul>
                        </div>
                        <!-- /.sidebar-collapse -->
                    </div>
                    <!-- /.navbar-static-side -->
                </nav>
                
                <div id="page-wrapper">
                    <div class="row">
                        <div>
                            <div class="panel panel-default">
                                <div class="panel-heading" id="ricFatt">
                                    <i></i>Richiesta Fattibilità
                                </div>
                                <div class="panel-body">
                                    <div class="row">
                                        <!-- Error message -->
                                        <div style="color:red;" id="showerror">
                                            <apex:pageMessages id="errors" /> 
                                        </div> 
                                        
                                        <apex:form styleClass="form-horizontal" id="theform">  
                                            <apex:actionRegion >
                                                <div class="form-group">
                                                    <div class="col-lg-6 col-offset-6">
                                                        <apex:commandButton styleClass="btn btn-primary"  action="{!Annulla}" value="Indietro"/>
                                                        <apex:commandButton style="margin-left: 2%;" styleClass="btn btn-primary" value="Nuovo collegamento" action="{!inserisciNuovoCollegamento}" id="button2" rendered="{!parentLogObj.EOF_Stato_Richiesta__c='Bozza Portale'}" reRender="pageBlock"/> &nbsp;&nbsp;                                                        
                                                        <apex:commandButton styleClass="btn btn-primary" value="Upload Offerta Accettata" action="{!AddParentAttachment}" id="button8" rendered="{!parentfile && parentLogObj.EOF_Stato_Richiesta__c != 'Bozza Portale' && parentLogObj.PO_Offerta_Caricata__c = false}" /> &nbsp;&nbsp;    <!---->                                                            
                                                        <!--<apex:commandButton styleClass="btn btn-primary" value="Aggiungi KIT" action="{!inserisciNuovoKit}" id="button9" rendered="{!parentLogObj.EOF_Stato_Richiesta__c='Bozza Portale'}"/> &nbsp;&nbsp;  -->
                                                        <!-- Bottoni -->
                                                        <apex:outputPanel id="AvailableButtons" rendered="{!IF(parentLogObj.Caso__r.Status=='In approvazione Cliente','true','false')}">
                                                            <!--<apex:commandButton styleClass="btn btn-primary" value="Accetta Offerta" action="{!OpportunityStageNameUpdate}"  id="button2" /> &nbsp;&nbsp; --> 
                                                            <!--<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal2">Accetta Offerta</button>-->
                                                            <apex:commandButton styleClass="btn btn-primary" value="Accetta Offerta" onclick="accettaOfferta();"  />
                                                            <!-- EC 2018 - 08 - 17 <apex:outputPanel rendered="{!parentCaseObj.PO_Offerta__c=='P2P Attiva'}">
<apex:commandButton styleClass="btn btn-primary" value="Accetta Offerta" action="{!OpportunityStageNameUpdate}" rendered="{parentCaseObj.PO_Offerta__c=='P2P Attiva'}"  />                                                           <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal18">Accetta Offerta</button>
</apex:outputPanel> EC commentiamo perché non è questo il bottone che viene mostrato -->
                                                            <apex:outputPanel id="id2">  <!-- rendered="{!parentCaseObj.PO_Offerta__c!='Fiber Lease'}" --> 
                                                                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">Modifica</button>
                                                                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal1">Rifiuta Offerta</button>
                                                            </apex:outputPanel>                                                         
                                                        </apex:outputPanel>
                                                        <apex:commandLink styleClass="btn btn-primary" onclick="checkInvio(); return false;"  value="Invia Richiesta" rendered="{!parentLogObj.EOF_Stato_Richiesta__c=='Bozza Portale'}"/> &nbsp;&nbsp;
                                                        <apex:actionstatus id="loadingStatus">
                                                            <apex:facet name="start">
                                                                <img class="waitingImage" src="/img/loading.gif" title="Caricamento..." />
                                                            </apex:facet>
                                                        </apex:actionstatus> 
                                                        <apex:commandButton styleClass="btn btn-primary"  action="{!deleteLog}" value="Elimina" rendered="{!parentLogObj.EOF_Stato_Richiesta__c='Bozza Portale'}"/>
                                                        
                                                        
                                                        
                                                        <apex:outputPanel rendered="{!parentLogObj.PO_Offerta_Caricata__c && parentLogObj.EOF_Stato_Richiesta__c !='Bozza Portale' && parentLogObj.PO_Offerta_Inoltrata__c = false}">
                                                            <apex:commandButton styleClass="btn btn-primary" value="Invia Ordine" action="{!ParentDataOrderUpdation}" />             
                                                        </apex:outputPanel>
                                                    </div> 
                                                </div>
                                                <apex:outputPanel id="infopage">
                                                    <table id="theTable" class="table table-striped table-bordered" width="100%">
                                                        <thead>
                                                            <tr>
                                                                <th>ID Richiesta Offerta  </th>
                                                                <th>Nome Progetto </th>
                                                                <th>Tipologia</th>
                                                                <apex:outputPanel rendered="{!IF( parentLogObj.EOF_STATO_ORDINE__c != 'Bozza Portale' , true , false)}">
                                                                    <th>Stato</th>
                                                                </apex:outputPanel>
                                                                <th>Data Apertura </th>
                                                                <th>Data Chiusura </th>
                                                                <th>Note</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <!--<apex:repeat value="{!testlog}" var="parentLogObj">-->
                                                            <tr>
                                                                <td>
                                                                    <apex:commandlink action="{!redirectparentlogdetail}" value="{!parentLogObj.EOF_Codice_Ordine_OLO__c}">
                                                                        <!-- <apex:param name="Id" assignTo="{!Id}" value="{!parentLogObj.id}"/>	-->
                                                                    </apex:commandlink>	
                                                                </td>
                                                                <td>
                                                                    <apex:outputText value="{!parentLogObj.PO_Nome_Progetto__c}"/>
                                                                </td>
                                                                <td>
                                                                    <apex:outputText value="{!parentLogObj.PO_Offerta__c}"/>
                                                                </td>
                                                                <apex:outputPanel rendered="{!IF( parentLogObj.EOF_STATO_ORDINE__c != 'Bozza Portale' , true , false)}">
                                                                    <td>
                                                                        <apex:outputText value="{!parentLogObj.EOF_STATO_ORDINE__c}"/>
                                                                    </td>
                                                                </apex:outputPanel>
                                                                <td>
                                                                    <apex:outputfield value="{!parentLogObj.CreatedDate}" />
                                                                </td>
                                                                <td>
                                                                    <apex:outputfield value="{!parentLogObj.caso__r.PO_Data_Espletamento_Ordine__c}" />
                                                                </td>
                                                                <td>
                                                                    <apex:outputText value="{!parentLogObj.PO_Nota_sito__c}" />
                                                                </td>
                                                            </tr>
                                                            <!--</apex:repeat>-->
                                                        </tbody>
                                                    </table>
                                                    <apex:outputPanel rendered="{!P2PAttivaLogList.size>0}">
                                                        <div class="panel panel-default">
                                                            <div class="panel-heading">
                                                                <i></i>Elenco Collegamenti 
                                                            </div>
                                                        </div>                                                
                                                        <apex:pageBlock >
                                                            <table id="theTable" class="table table-striped table-bordered" width="100%">
                                                                
                                                                <tr>
                                                                    <th>ID Richiesta di Collegamento</th>
                                                                    <th>ID Sede</th>
                                                                    <th>ID Richiesta Offerta</th>
                                                                    <!-- <th>ID Ordine Collegamento</th>-->
                                                                    <!--<th>Tipo Percorso </th>-->
                                                                    <th>Indirizzo Collegamento </th>
                                                                    <th>Comune</th> 
                                                                    <apex:outputPanel rendered="{!tipoP2PAttiva!='eLine'}">                                                                   
                                                                        <th>Nome KIT</th>
                                                                    </apex:outputPanel>
                                                                    <th>Profilo</th>
                                                                    <th>Stato</th>
                                                                </tr>
                                                                
                                                                <tbody>
                                                                    <!-- <apex:pageBlock >
<apex:variable var="count" value="{!0}"/> 
<apex:pageBlockTable value="{!slWrapList}" var="item"  styleClass="table table-striped table-bordered">

<apex:column >
<apex:facet name="header">
<apex:outputText value="ID Richiesta di Collegamento"/> 
</apex:facet>
<apex:commandlink value="{!item.sLogColl.EOF_Codice_Ordine_OLO__c}" action="{!EditLogInfo}" rendered="{!item.sLogColl.EOF_Stato_Richiesta__c == 'Bozza Portale'}">
<apex:param name="cLogId" assignTo="{!childlogdisplayid}" value="{!item.sLogColl.Id}"/>
</apex:commandlink>

<apex:commandLink action="{!redirectchildlogdetail}"  value="{!item.sLogColl.EOF_Codice_Ordine_OLO__c}" rendered="{!item.sLogColl.EOF_Stato_Richiesta__c != 'Bozza Portale'}" >
<apex:param name="CaseDetail" assignTo="{!childlogdisplayid}" value="{!item.sLogColl.Id}"/>
</apex:commandlink>	
</apex:column>
<apex:column value="{!parentLogObj.EOF_Codice_Ordine_OLO__c}" headerValue="ID Richiesta Offerta"/>
<apex:column value="{!item.sLogColl.ID_Sede__c}" headerValue="ID Sede"/>
<apex:column value="{!item.sLogColl.Particella_Toponomastica_1__c }   {!item.sLogColl.PO_Indirizzo_collegamento__c }   {!item.sLogColl.PO_Civico__c }" headerValue="Indirizzo Collegamento"/>
<apex:column value="{!item.sLogColl.EOF_Comune__c}" headerValue="Comune"/>
<apex:column value="{!item.nomeKit}" headerValue="Nome KIT"/>
<apex:column value="{!item.profilosVlan}" headerValue="Profilo"/>
<apex:column value="{!item.sLogColl.EOF_STATO_ORDINE__c}" headerValue="Stato"/>

</apex:pageBlockTable>
</apex:pageBlock>--> 
                                                                    
                                                                    
                                                                    <apex:repeat value="{!slWrapList}" var="objWrap" >
                                                                        <tr>
                                                                            <td> 
                                                                                <apex:commandlink value="{!objWrap.sLogColl.EOF_Codice_Ordine_OLO__c}" action="{!EditLogInfo}" rendered="{!objWrap.sLogColl.EOF_Stato_Richiesta__c == 'Bozza Portale'}">
                                                                                    <apex:param name="cLogId" assignTo="{!childlogdisplayid}" value="{!objWrap.sLogColl.Id}"/>
                                                                                </apex:commandlink>
                                                                                
                                                                                <apex:commandLink action="{!redirectchildlogdetail}"  value="{!objWrap.sLogColl.EOF_Codice_Ordine_OLO__c}" rendered="{!objWrap.sLogColl.EOF_Stato_Richiesta__c != 'Bozza Portale'}">
                                                                                    <apex:param name="CaseDetail" assignTo="{!childlogdisplayid}" value="{!objWrap.sLogColl.Id}"/>
                                                                                </apex:commandlink>	
                                                                                
                                                                            </td>
                                                                            <td>
                                                                                <apex:outputText value="{!objWrap.sLogColl.ID_Sede__c}"/>
                                                                            </td>
                                                                            
                                                                            <td>
                                                                                <apex:outputText value="{!parentLogObj.EOF_Codice_Ordine_OLO__c}"/>
                                                                            </td>     
                                                                            
                                                                            
                                                                            
                                                                            <!-- <td>
<apex:outputText value="{!logObj.PO_Tipo_percorso__c}"/>
</td>-->
                                                                            <td>
                                                                                <apex:outputText value="{!objWrap.sLogColl.Particella_Toponomastica_1__c }   {!objWrap.sLogColl.PO_Indirizzo_collegamento__c }   {!objWrap.sLogColl.PO_Civico__c }"/>
                                                                            </td>
                                                                            <td>
                                                                                <apex:outputText value="{!objWrap.sLogColl.EOF_Comune__c}"/>
                                                                            </td>
                                                                            <!--<apex:outputPanel rendered="{!IF(ISNULL(sLogKit.PO_P2PAttiva_Nome_del_KIT__c) , false , true)}">-->
                                                                            <apex:outputPanel rendered="{!tipoP2PAttiva!='eLine'}">  
                                                                                <td>
                                                                                    <apex:outputText value="{!objWrap.nomeKit}" />
                                                                                </td>
                                                                            </apex:outputPanel>
                                                                            <!--  </apex:outputPanel>-->
                                                                            <apex:outputPanel >
                                                                                <td>
                                                                                    <apex:outputText value="{!objWrap.profilosVlan}" />
                                                                                </td>
                                                                            </apex:outputPanel>
                                                                            <td>
                                                                                <apex:outputText value="{!objWrap.sLogColl.EOF_STATO_ORDINE__c}"/>
                                                                            </td>
                                                                        </tr>
                                                                    </apex:repeat> 
                                                                </tbody>
                                                            </table>
                                                        </apex:pageBlock>
                                                    </apex:outputPanel> 
                                                    <apex:outputPanel rendered="{!orderLogs.size>0}" id="ordersec">
                                                        <div class="panel panel-default">
                                                            <div class="panel-heading">
                                                                <i></i>Elenco Ordine  
                                                            </div>
                                                        </div>    
                                                        <table id="theTable" class="table table-striped table-bordered" width="100%">
                                                            <thead>
                                                                <tr>
                                                                    <th>ID Ordine Collegamento </th>
                                                                    <th>ID Richiesta di Collegamento </th>
                                                                    <!--<th>Tipo percorso</th>-->
                                                                    <th>Indirizzo collegamento</th>
                                                                    <th>Comune </th>
                                                                    <th>Data Apertura </th>
                                                                    <th>Data Chiusura </th>
                                                                    <th>Stato</th>
                                                                    <th></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <apex:repeat value="{!orderLogs}" var="logobj" >
                                                                    <tr>
                                                                        <td>
                                                                            <apex:commandlink value="{!logobj.EOF_Codice_Ordine_OLO__c}" action="{!EditOrderInfo}" >
                                                                                <apex:param name="CaseDetail" assignTo="{!CaseDetail}" value="{!logobj.Caso__c}"/>
                                                                            </apex:commandlink>
                                                                        </td>
                                                                        <td>
                                                                            <apex:outputText value="{!logobj.EOF_SL_Riferimento__r.EOF_Codice_Ordine_OLO__c}"/>
                                                                        </td>                                                               
                                                                        <!--<td>
<apex:outputText value="{!logobj.PO_Tipo_percorso__c}"/>
</td>-->
                                                                        <td>
                                                                            <apex:outputText value="{!logObj.Particella_Toponomastica_1__c }   {!logObj.PO_Indirizzo_collegamento__c }   {!logObj.PO_Civico__c }"/>
                                                                        </td>
                                                                        <td>
                                                                            <apex:outputText value="{!logobj.EOF_Comune__c}"/>
                                                                        </td>
                                                                        <td>
                                                                            <apex:outputfield value="{!logobj.caso__r.CreatedDate}"/>
                                                                        </td>
                                                                        <td>
                                                                            <apex:outputfield value="{!logobj.caso__r.ClosedDate}"/>
                                                                        </td>
                                                                        <td>
                                                                            <!-- V1 BUGFIX P2PATTIVA inizio -->
                                                                            
                                                                            <apex:outputText value="{!logobj.EOF_STATO_ORDINE__c}"/>
                                                                            
                                                                            <!--<apex:outputText rendered="{!(logobj.Caso__r.parent.parent.PO_isDataOrder__c=false && (logobj.Caso__r.PO_Nome_E_Cognome_PM__c == null || logobj.Caso__r.PO_Data_Attivazione_Richiesta__c == null || logobj.Caso__r.PO_Numero_Telefonico_PM__c == null)) }" value="{!logobj.EOF_STATO_ORDINE__c}"/>
<apex:outputText rendered="{!AND(logobj.Caso__r.PO_Nome_E_Cognome_PM__c != null, logobj.Caso__r.PO_Data_Attivazione_Richiesta__c != null ,logobj.Caso__r.PO_Numero_Telefonico_PM__c != null)}" value="Completato"/>-->
                                                                            <!-- V1 BUGFIX P2PATTIVA fine -->
                                                                        </td>
                                                                        <td>    
                                                                            <apex:commandlink value="Completa Ordine" action="{!collegmentaDate}" styleClass="btn btn-primary" rendered="{!(logobj.Caso__r.parent.parent.PO_isDataOrder__c=false && (logobj.Caso__r.PO_Nome_E_Cognome_PM__c == null || logobj.Caso__r.PO_Data_Attivazione_Richiesta__c == null || logobj.Caso__r.PO_Numero_Telefonico_PM__c == null)) }" >
                                                                                <apex:param value="{!logobj.id}" name="recid" assignTo="{!recid}" />
                                                                            </apex:commandlink>  
                                                                            <apex:commandButton value="Completa Ordine" styleClass="btn btn-success" disabled="{!AND(logobj.Caso__r.PO_Nome_E_Cognome_PM__c != null, logobj.Caso__r.PO_Data_Attivazione_Richiesta__c != null ,logobj.Caso__r.PO_Numero_Telefonico_PM__c != null)}" rendered="{!AND(logobj.Caso__r.PO_Nome_E_Cognome_PM__c != null, logobj.Caso__r.PO_Data_Attivazione_Richiesta__c != null ,logobj.Caso__r.PO_Numero_Telefonico_PM__c != null)}"/>                                                          
                                                                            <!-- AA Commentato e sostituito
<apex:commandlink value="Completa Ordine" action="{!collegmentaDate}" styleClass="btn btn-primary" rendered="{!(logobj.Caso__r.parent.parent.PO_isDataOrder__c=false && (logobj.Caso__r.PO_Nome_E_Cognome_PM__c == null || logobj.Caso__r.PO_Data_Attivazione_Richiesta__c == null || logobj.Caso__r.PO_Numero_Telefonico_PM__c == null)) }" >
<apex:param value="{!logobj.id}" name="recid" assignTo="{!recid}" />
</apex:commandlink>                                                                   
<apex:commandButton value="Completa Ordine" styleClass="btn btn-success" rendered="{!AND(caseobj.PO_Nome_E_Cognome_PM__c != null, caseobj.PO_Data_Attivazione_Richiesta__c != null ,caseobj.PO_Numero_Telefonico_PM__c != null,caseobj.PO_Case_Collegamento__r.parent.PO_isDataOrder__c=false)}"/>
<apex:commandButton value="Completa Ordine" styleClass="btn btn-primary" disabled="{!caseobj.PO_Case_Collegamento__r.parent.PO_isDataOrder__c=true}" rendered="{!caseobj.PO_Case_Collegamento__r.parent.PO_isDataOrder__c=true}"/>                                                                    
-->
                                                                        </td>
                                                                    </tr>
                                                                </apex:repeat>                                                          
                                                            </tbody>
                                                        </table>
                                                    </apex:outputPanel>                                                    
                                                    
                                                </apex:outputPanel> 
                                                <apex:outputPanel rendered="{!newAtt.size>0}" id="attsec1">
                                                    <div class="panel panel-default">
                                                        <div class="panel-heading">
                                                            <i></i>Offerta
                                                        </div>
                                                        <table id="theTable" class="table table-striped table-bordered" width="100%">
                                                            <thead>
                                                                <tr>
                                                                    <th>Allegato </th>
                                                                    <th>Data Creazione </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <apex:repeat value="{!newAtt}" var="att">
                                                                    <tr>
                                                                        <td>         
                                                                            <apex:outputLink value="{!URLFOR($Action.Attachment.Download, att.Id)}" target="_blank">{!att.Name}</apex:outputLink>                                                                                                                                                
                                                                        </td> 
                                                                        <td>
                                                                            <apex:outputField value="{!att.createdDate}" />
                                                                        </td>
                                                                    </tr> 
                                                                </apex:repeat>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!attxlxs.size>0}" id="attsec3">
                                                    <div class="panel panel-default">
                                                        <div class="panel-heading">
                                                            <i></i>Dettaglio Offerta
                                                        </div>
                                                        <table id="theTable" class="table table-striped table-bordered" width="100%">
                                                            <thead>
                                                                <tr>
                                                                    <th>Allegato </th>
                                                                    <th>Data Creazione </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <apex:repeat value="{!attxlxs}" var="att">
                                                                    <tr>
                                                                        <td>
                                                                            <apex:outputLink value="{!URLFOR($Action.Attachment.Download, att.Id)}" target="_blank">{!att.Name}</apex:outputLink>                                                                                                                                                
                                                                        </td> 
                                                                        <td>
                                                                            <apex:outputField value="{!att.createdDate}" />
                                                                        </td>
                                                                    </tr> 
                                                                </apex:repeat>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!attlst.size>0}" id="attsec2">
                                                    <div class="panel panel-default">
                                                        <div class="panel-heading">
                                                            <i></i>Elenco Offerte Precedenti 
                                                        </div>
                                                        <table id="theTable" class="table table-striped table-bordered" width="100%">
                                                            <thead>
                                                                <tr>
                                                                    <th>Allegato </th>
                                                                    <th>Data Creazione </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <apex:repeat value="{!attlst}" var="att">
                                                                    <tr>
                                                                        <td>                                                                
                                                                            <apex:outputLink value="{!URLFOR($Action.Attachment.Download, att.Id)}" target="_blank">{!att.Name}</apex:outputLink>                                                                    
                                                                        </td> 
                                                                        <td>
                                                                            <apex:outputField value="{!att.createdDate}" />
                                                                        </td>
                                                                    </tr> 
                                                                </apex:repeat>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!kitList.size>0}" id="kitLogColl">
                                                    <div class="panel panel-default">
                                                        <div class="panel-heading">
                                                            <i></i> KIT inseriti
                                                        </div>
                                                    </div>                                                
                                                    
                                                    <table id="theTable" class="table table-striped table-bordered" width="100%">
                                                        <thead>
                                                            <tr>
                                                                <th>Nome KIT</th>
                                                                <th>Indirizzo Consegna</th>
                                                                <th>Nome POP Openfiber</th>
                                                                <th>Optical Rate Limiting</th>
                                                                <th>Codice Ordine OLO</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <apex:variable var="count" value="{!0}"/> 
                                                            <apex:repeat value="{!kitList}" var="kLogObj" >
                                                                <tr>
                                                                    <td> 
                                                                        <apex:commandlink value="{!kLogObj.PO_P2PAttiva_Nome_del_KIT__c}" action="{!goToKITpage}">
                                                                            <apex:param name="kitId" assignTo="{!kitLogId}" value="{!kLogObj.Id}"/>
                                                                        </apex:commandlink>
                                                                    </td>
                                                                    
                                                                    <td>
                                                                        <apex:outputText value="{!kLogObj.PO_P2PAttiva_KIT_Indirizzo_Consegna__c}"/>
                                                                    </td>
                                                                    
                                                                    <td>
                                                                        <apex:outputText value="{!kLogObj.EOF_ID_Pop__c}"/>
                                                                    </td>
                                                                    
                                                                    <td>
                                                                        <apex:outputText value="{!kLogObj.PO_P2PAttiva_Optical_Rate_Limiting__c}"/>
                                                                    </td>
                                                                     <td>
                                                                        <apex:outputText value="{!kLogObj.EOF_Codice_Ordine_OLO__c}"/>
                                                                    </td>
                                                                </tr>
                                                            </apex:repeat>
                                                        </tbody>
                                                    </table>
                                                </apex:outputPanel>
                                                <!--ORDINE DI COLLEGAMENTO-->
                                                
                                                <!--EC 2018 - 09 - 20      <apex:outputPanel rendered="{!caseobj.PO_Incluso_nell_offerta__c == true}">
<apex:outputField value="{!orderCases[count].casenumber}"  rendered="{!orderCases.size>0 }"/>
<apex:variable value="{!count+1}" var="count"/>
</apex:outputPanel>

</td> 
<td>
<apex:outputText value="{!logObj.PO_Tipo_percorso__c}"/>
</td>
<td>
<apex:outputText value="{!logObj.PO_Indirizzo_collegamento__c }"/>
</td>
<td>
<apex:outputText value="{!logObj.EOF_Comune__c}"/>
</td>
<td>
<apex:outputText value="{!logObj.EOF_STATO_ORDINE__c}"/>
</td>
</tr>
</apex:repeat> 
</tbody>
</table>
</apex:outputPanel> 	
-->
                                                <!-- EC 2018 - 09 - 20 -->
                                                
                                                <div class="modal fade" id="myModal" role="dialog" style="width:100%">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                                <h4 class="modal-title">Modifica</h4>
                                                            </div>
                                                            <div class="modal-body">
                                                                <lable>Note Modifica Offerta</lable>
                                                                <!--<apex:inputTextarea value="{!textarea}" cols="3"  rows="3" style="height: 100px;width:500px;" />-->
                                                                <apex:inputField style="width:100%" id="NoteModificaOfferta" value="{!parentLogObj.PO_Note_Modifica_Offerta__c}" />
                                                                
                                                                
                                                            </div>
                                                            <div class="modal-body"  style="width:100%">
                                                            </div>
                                                            <div>
                                                                <table id="theTable" class="table table-striped table-bordered" width="100%">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>Collegamento</th>
                                                                            <th>Incluso nell’offerta</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <apex:repeat value="{!P2PAttivaLogList}" var="logColl" >
                                                                            <tr>
                                                                                <td>
                                                                                    <apex:outputfield value="{!logColl.Caso__r.casenumber}" />
                                                                                </td>
                                                                                <td>
                                                                                    <apex:inputfield value="{!logColl.PO_Incluso_nell_offerta__c}" />
                                                                                </td>
                                                                            </tr>
                                                                        </apex:repeat>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <apex:commandButton value="Modifica" onclick="validateform();return false;" styleClass="btn btn-primary" />
                                                                <apex:actionFunction name="OpportunityStageNameUpdate2method" action="{!OpportunityStageNameUpdate2}"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="modal fade" id="myModal1" role="dialog">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                                <h4 class="modal-title">Rifiuta Offerta</h4>
                                                            </div>
                                                            <div class="modal-body">
                                                                <lable>Note Rifiuta Offerta</lable>
                                                                <apex:inputTextarea value="{!textarea1}" cols="3"  rows="3" style="height: 100px;width:500px;" />
                                                            </div>
                                                            <div class="modal-footer">
                                                                <apex:commandButton value="Rifiuta" action="{!OpportunityStageNameUpdate3}" styleClass="btn btn-primary" rerender="theform" id="button7"  onComplete="$('#myModal1').modal('hide');$('body').removeClass('modal-open');$('.modal-backdrop').remove()"  /><!--onclick="javascript:window.location.reload()"-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div> 
                                                <div class="modal fade" id="myModal2" role="dialog">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                                <h4 class="modal-title"><p class="alert alert-success"><b>Success!!</b></p></h4>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p class="text-primary"><b>Casi di ordine creati con successo </b></p>
                                                                <!--<p class="text-primary"> <b>collegamento inclusi nell'offerta.</b></p>                                                                
<p class="text-primary"><b>Per ciascuno di tali collegamenti,entrare nel dettaglio e cliccare sul</b></p>                                                                
<p class="text-primary"><b>bottone "Invia dati Ordine."</b></p>                                                                
<p class="text-primary"><b> Al termine dell'inserimento di tutti i dati,sara possible cliccare sul</b></p>                                                                
<p class="text-primary"><b>bottone "Invia Ordine." </b></p>-->                                                                
                                                            </div>                                                            
                                                            <div class="modal-footer">                                                                
                                                                <apex:commandButton value="Continua" action="{!OpportunityStageNameUpdate}" styleClass="btn btn-primary" rerender="theform" onComplete="$('#myModal1').modal('hide');$('body').removeClass('modal-open');$('.modal-backdrop').remove()"  /><!--onclick="javascript:window.location.reload()"-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div> 
                                                <div class="modal fade" id="myModal3" role="dialog">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                                <h4 class="modal-title"><p class="text-danger"><b>Attenzione!!</b></p></h4>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p class="text-primary"><b>Per poter inviare I'ordine e necessario inserire ulteriori dati per tutti i </b></p>                                                                
                                                                <p class="text-primary"> <b>collegamento inclusi nell'offerta.</b></p>                                                                
                                                                <p class="text-primary"><b>Per ciascuno di tali collegamenti,entrare nel dettaglio e cliccare sul</b></p>                                                                
                                                                <p class="text-primary"><b>bottone "Invia dati Ordine."</b></p>                                                                
                                                                <p class="text-primary"><b> Al termine dell'inserimento di tutti i dati,sara possible cliccare sul</b></p>                                                                
                                                                <p class="text-primary"><b>bottone "Invia Ordine." </b></p>                                                                
                                                            </div>                                                            
                                                            <div class="modal-footer">                                                                
                                                                <apex:commandButton value="Continua" action="{!OpportunityStageNameUpdate}" styleClass="btn btn-primary" rerender="theform" onComplete="$('#myModal1').modal('hide');$('body').removeClass('modal-open');$('.modal-backdrop').remove()"  /><!--onclick="javascript:window.location.reload()"-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>                                                  
                                                <div class="modal fade" id="myModal5" role="dialog">
                                                    <div class="modal-dialog">
                                                        <apex:pageMessages id="pgmid"/>
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                                <h4 class="modal-title">Collegamento</h4>
                                                            </div>
                                                            <div class="modal-body">
                                                                <form id="loginForm" method="post" class="form-horizontal">
                                                                    <div class="form-group has-error">
                                                                        <label class="control-label col-sm-3" for="date">Data Attivazione Richiesta Cliente</label>
                                                                        <div class="col-sm-6">
                                                                            <apex:input type="date"  value="{!childrecdate}" size="10" id="date"  onfocus="DatePicker.pickDate(false, 'myPage:myForm:demo', false);"  />
                                                                            <!--<apex:inputfield value="{!childCaseObj.PO_Nome_E_Cognome_PM__c}"     />-->                                                                     
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label class="control-label col-sm-3" for="PMRiferimento">PM Riferimento</label>
                                                                        <div class="col-sm-6">
                                                                            <apex:inputfield value="{!caseobj.PO_Nome_E_Cognome_PM__c}" id="txtid1" />
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label class="control-label col-sm-3" for="Telefono">Telefono PM</label>
                                                                        <div class="col-sm-6">
                                                                            <apex:inputfield value="{!caseobj.PO_Numero_Telefonico_PM__c}" id="txtid" />
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <div class="col-sm-6">
                                                                            <label class="control-label col-sm-3" for="CaseNumber">Case Number</label>                                                               
                                                                            <apex:outputfield value="{!caseobj.casenumber}" id="cseid" />
                                                                        </div>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                            <div class="modal-footer">                                                         
                                                                <apex:commandButton value="Annulla" action="{!DisplayCaseInfo}" styleClass="btn btn-primary" rerender="theform"  onComplete="$('#myModal1').modal('hide');$('body').removeClass('modal-open');$('.modal-backdrop').remove()"  immediate="true"  html-formnovalidate="formnovalidate"/>
                                                                <!--onclick="javascript:window.location.reload()"-->
                                                                <apex:commandButton value="Salva" action="{!collegmentaDate}" styleClass="btn btn-primary" rerender="theform,sec1,sce2"   onComplete="$('#myModal1').modal('hide');$('body').removeClass('modal-open');$('.modal-backdrop').remove()"  onclick="javascript:window.location.reload()" id="loginFormSubmit" reRender="pgmid"/><!--onclick="javascript:window.location.reload()"-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div> 
                                                <div class="modal fade" id="myModal7" role="dialog">
                                                    <div class="modal-dialog">                                                            
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                                <h4 class="modal-title"><p class="text-danger"><b>Attenzione!!</b></p></h4>
                                                            </div>
                                                            <div class="modal-body">                                                                                                                                    
                                                                <p class="text-primary"><b>Cliccare sul link per ciascum ordine in elenco e quindi sul bottone  </b></p>                                                                    
                                                                <p class="text-primary"> <b>"invia dati ordine",per inserire i dati necessari.</b></p>                                                                    
                                                                <p class="text-primary"><b>L'ordine sara lavorato solo ai termine dell'inserimento dei dati richiest per </b></p>                                                                    
                                                                <p class="text-primary"><b>tutti gli ordini</b></p>                                                                                                                                        
                                                            </div>                                                                
                                                            <div class="modal-footer">                                                                             
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div> 
                                                <div class="modal fade" id="myModal18" role="dialog" style="width:100%">
                                                    <div class="modal-dialog">                                                        
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                                <h4 class="modal-title">Inserire il numero anni di affitto richiesto</h4>
                                                            </div>                                                         
                                                            <div class="modal-body"  style="width:100%">
                                                                <apex:outputPanel rendered="{!parentCaseObj.PO_Offerta__c=='Fiber Link'}">
                                                                    <!--<lable>Durata affitto</lable>-->
                                                                    <apex:outputLabel >Durata affitto(anni)&nbsp;&nbsp;</apex:outputLabel>
                                                                    <!--<apex:inputTextarea value="{!textarea}" cols="3"  rows="3" style="height: 100px;width:500px;" />-->
                                                                    <!--   <apex:inputText id="Durataaffitto1" value="{!parentCaseObj.PO_Durata_affitto__c}"  /> -->
                                                                </apex:outputPanel>
                                                            </div>
                                                            <div class="modal-footer">                                                                
                                                                <!-- <apex:commandButton value="Modifica" onclick="validateform();return false;" styleClass="btn btn-primary"    />--oncomplete="getRemoteAccount()  reRender="theform""--->
                                                                -->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>                                                 
                                            </apex:actionRegion>
                                            <!--
<apex:actionFunction name="inviaRichiesta" reRender="tabResult" action="{!InviaRichiesta_2}" status="loadingStatus" onComplete="rienableButton()"/>        
-->
                                            <apex:actionFunction name="inviaRichiesta" reRender="showerror, errors" action="{!InviaRichiesta_2}" status="loadingStatus" onComplete="rienableButton()"/>
                                            <apex:actionFunction name="accOfferta" reRender="showerror, errors" action="{!OpportunityStageNameUpdate}" status="loadingStatus" onComplete="rienableButton()"/>
                                        </apex:form>                                      
                                    </div>
                                </div>
                                <!-- /.panel-body -->
                            </div>       
                            <!-- /.col-lg-4 -->
                        </div>
                        <!-- /.row -->
                    </div>
                    <!-- /#page-wrapper -->                        
                </div>
            </div>
            <!-- /#wrapper -->        
            <apex:includeScript value="{!URLFOR($Resource.ENELfiles, 'ENELfiles/EnelStylesheets/files/vendor/jquery/jquery.min.js')}"/>                
            <!-- Bootstrap Core JavaScript -->
            <apex:includeScript value="{!URLFOR($Resource.ENELfiles, 'ENELfiles/EnelStylesheets/files/vendor/bootstrap/js/bootstrap.min.js')}"/>
            <script src='https://www.google.com/recaptcha/api.js'></script>                
            </body>                
            </html>               
            <script type="text/javascript">
            <!-- EC modifica type script. Prima era <script>, ora sostituito con <script type="text/javascript">  --> 
                function validateform(){
                var invalidflg = false; 
                var PO_Offerta = '{!parentCaseObj.PO_Offerta__c}';  
                var Durataaffitto = $('[id$=Durataaffitto]').val();
                if(PO_Offerta == 'Fiber Link'){
                    if(Durataaffitto.length == 0){
                        $('[id$=Durataaffitto]').next('div.red').remove();
                        $('[id$=Durataaffitto]').after('<div class="red">Inserire il numero di anni di affitto di interesse, cliccando su Modifica</div>');
                        invalidflg = true;
                    }else{
                        $('[id$=Durataaffitto]').next('div.red').remove();
                    }
                }
                if(invalidflg){
                    return false;
                }                 
                OpportunityStageNameUpdate2method();
            }
            function accettaOfferta() {
                disableButton();
                accOfferta();
            }
            function checkInvio(){
                debugger;
                var check=false;
                var slColSatList =  new Array();
                var tipoP2PAtt= '{!tipoP2PAttiva}';
                slColSatList = '{!slCollSatelliteList}';
                var existsMaster = '{!existsMaster}';
                var existsOneMaster = '{!existsOneMaster}';
                if(existsMaster == 'false' && tipoP2PAtt == 'eLine') {
                    alert('Le Sedi Satellite devono essere associate ad una Sede Master!');
                    check = true;
                }
                else if(existsOneMaster == 'false' && tipoP2PAtt == 'eLine'){
                     alert('Non è possibile inviare una richiesta senza aver creato un Satellite!');
                    check = true;
                }
                /*window.alert('@@@@EC VlanCollegamentiOK è '+ {!VlanCollegamentiOK});
                window.alert('@@@@EC slCollSatelliteList length: ' + slColSatList.length);
                window.alert('@@@@EC tipoP2PAttiva assegnata a tipoP2PAtt: ' + tipoP2PAtt);*/
                debugger;
                if(tipoP2PAtt != 'eLine'){
	                if('{!VlanCollegamentiOK}' == 'false'){
                        //window.alert('@@@@EC tipoP2PAttiva assegnata a {!VlanCollegamentiOK}: ' + '{!VlanCollegamentiOK}');
	                    $('[id$=ricFatt]').next('div.red').remove();
	                    $('[id$=ricFatt]').after('<div class="red">Per almeno uno dei Collegamenti non è stato selezionato un Profilo o un KIT</div>');
	                    check = true;
	                }
	                else{
	                    $('[id$=ricFatt]').next('div.red').remove();
	                }
	                if(!check){
	                    if("{!checkKitSenzaVlan}" == 'true'){ 
	                        var r = window.confirm("Ci sono dei kit senza vlan associate che non verranno presi in considerazione. Continuare?")
	                        if(r == false ){
	                            check = true;
	                        }
	                    }
	                }
	            }
	            else{
	            
                    //window.alert('@@@@EC tipoP2PAtt è: ' + tipoP2PAtt);
	           		if('{!VlanCollegamentiOK}' == 'false'){
	            		$('[id$=ricFatt]').next('div.red').remove();
	                    $('[id$=ricFatt]').after('<div class="red">Per almeno uno dei Collegamenti Satellite non è stato selezionato un Profilo</div>');
	                    check = true;
	            	}
	            	 else{
	                    $('[id$=ricFatt]').next('div.red').remove();
	                }
	            }
	               
                if(!check){
                    //window.alert('@@@@EC check è: ' + check + ', quindi stiamo per chiamare disableButton e InviaRichiesta');
                    disableButton()
                    inviaRichiesta();
                }
            }    
            function disableButton(){
                $( ".btn" ).prop("disabled",true);
            }
            function rienableButton(){
                $( ".btn" ).prop("disabled",false);
            }
            </script>
        </apex:page>